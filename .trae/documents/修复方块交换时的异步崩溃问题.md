# 统一胜利与失败的结算等待机制

## 问题确认
您观察得很敏锐。目前的逻辑中，**确实只有“失败”才走了等待空闲的流程**。
在“胜利” (`checkResult`) 的逻辑中，代码直接暂停了游戏并弹出了结算界面，导致最后一步的消除特效被强行打断。

## 修复方案
我们需要将胜利和失败的结算逻辑统一，都必须等待所有特效（连锁消除、爆炸）结束后才能弹出。

### 1. 改造胜利逻辑
修改 `checkResult` 方法，不再立即暂停和弹窗，而是进入等待状态。
- **文件**: `assets/Script/game/Game.ts`
- **修改**:
  - 移除 `EventManager.emit(EventName.Game.Pause)`。
  - 移除直接加载 `resultView` 的代码。
  - 改为设置 `this.isGameOverWaiting = true`（利用现有的等待标记）。

### 2. 改造等待与执行逻辑
修改 `update` 和 `performGameOver`，使其支持胜利和失败两种情况。
- **文件**: `assets/Script/game/Game.ts`
- **修改 `update`**:
  - 应用之前的修复：**移除超时限制**，**增加粒子特效检查**。
- **修改 `performGameOver`**:
  - 根据 `this.gameState` (WIN 或 GAME_OVER) 来决定弹出胜利界面还是失败界面。
  - 在这里执行 `App.gameCtr.setPause(true)`。

### 3. 最终效果
无论是胜利还是失败，游戏都会耐心地等待所有连锁消除和爆炸特效播放完毕，画面完全静止后，再优雅地弹出对应的结算窗口。